<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ランチメニュー・ルーレット</title>
  <style>
    body{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;margin:0;font-family:'Segoe UI',sans-serif;background:#f5f5f5}
    #wheel-wrapper{position:relative;width:500px;height:500px}
    /* ▲ 포인터 : 위쪽(12시)으로 이동 */
    #pointer{position:absolute;top:-20px;left:50%;width:0;height:0;border-left:15px solid transparent;border-right:15px solid transparent;border-bottom:20px solid #ff4757;transform:translateX(-50%)}
    #spinBtn{margin-top:30px;padding:12px 28px;font-size:18px;border:none;border-radius:8px;cursor:pointer;background:#1e90ff;color:#fff;box-shadow:0 4px 8px rgba(0,0,0,.2);transition:background .3s}
    #spinBtn:hover{background:#0074d9}
    #result{margin-top:18px;font-size:24px;font-weight:700;color:#333}
    svg text{font-size:18px;fill:#fff;font-weight:bold;text-anchor:middle;dominant-baseline:middle;}
  </style>
</head>
<body>
  <div id="wheel-wrapper">
    <svg id="wheel" viewBox="-250 -250 500 500" width="500" height="500"></svg>
    <div id="pointer"></div>
  </div>
  <button id="spinBtn">回す / 돌리기</button>
  <div id="result"></div>

  <!-- GSAP CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <!-- confetti CDN -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
  // ------- メニュー設定 -------------
  const options = [
    "寿司", "ラーメン", "カレー", "天ぷら", "うどん", "そば", "お好み焼き", "焼き鳥"
  ];
  const colors = ["#f94144","#f3722c","#f9844a","#f9c74f","#90be6d","#43aa8b","#577590","#277da1"];
  //-----------------------------------
  const wheel = document.getElementById('wheel');
  const segAngle = 360 / options.length;
  const r = 240;
  const rad = a => (Math.PI/180)*a;

  // ---------- 슬라이스 & 라벨 생성 -----------
  options.forEach((label, i) => {
    const start = segAngle * i;
    const end = start + segAngle;
    const largeArc = segAngle > 180 ? 1 : 0;
    const x1 = r * Math.cos(rad(start));
    const y1 = r * Math.sin(rad(start));
    const x2 = r * Math.cos(rad(end));
    const y2 = r * Math.sin(rad(end));

    const pathData = `M0 0 L${x1} ${y1} A${r} ${r} 0 ${largeArc} 1 ${x2} ${y2} Z`;
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', pathData);
    path.setAttribute('fill', colors[i]);
    wheel.appendChild(path);

    // 라벨 중앙 위치
    const midAngle = start + segAngle/2;
    const labelR = r*0.6;
    const lx = labelR * Math.cos(rad(midAngle));
    const ly = labelR * Math.sin(rad(midAngle));

    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x', lx);
    text.setAttribute('y', ly);
    // ▼ 글씨가 거꾸로 보이지 않도록 상하반전 보정
    const flip = (a)=> (a>90 && a<270) ? 180 : 0;
    text.setAttribute('transform', `rotate(${midAngle+flip(midAngle)} ${lx} ${ly})`);
    text.textContent = label;
    wheel.appendChild(text);
  });

  let currentRotation = 0;
  const resultBox = document.getElementById('result');

  document.getElementById('spinBtn').addEventListener('click', () => {
    resultBox.textContent = '';
    const targetIndex = Math.floor(Math.random()*options.length);
    const spins = Math.floor(Math.random()*3) + 5; // 5‑7회전
    // ▲ 포인터가 0°(12시) 위치이므로 +180 보정을 제거
    const targetDeg = currentRotation + spins*360 + (options.length - targetIndex) * segAngle - segAngle/2;

    gsap.to(wheel, {
      rotate: targetDeg,
      duration: 4,
      ease: "power4.out",
      onComplete: () => {
        currentRotation = targetDeg % 360;
        resultBox.textContent = `🎉 今日のランチは「${options[targetIndex]}」です！`;
        // 폭죽 효과
        confetti({particleCount: 160, spread: 70, origin:{y:0.6}});
      }
    });
  });
  </script>
</body>
</html>
